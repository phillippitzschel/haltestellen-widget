<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>MVV Abfahrten – Homey Widget</title>

  <style>
    /* Das iFrame/Homey-Widget soll komplett genutzt werden */
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;            /* wichtig: keine Scrollbars im Homey-Widget */
      background: transparent;
    }

    /* Container füllt immer den kompletten verfügbaren Platz */
    #viewport {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;            /* wir skalieren, statt abzuschneiden */
    }

    /*
      #content wird skaliert.
      min-width/min-height verhindern, dass der Inhalt “zusammenfällt”,
      während das MVV-Script initial rendert.
    */
    #content {
      position: absolute;
      top: 0;
      left: 0;
      transform-origin: 0 0;       /* Skalierung ab oben/links */
      will-change: transform;
      min-width: 320px;
      min-height: 200px;
    }

    /* Optional: Schärferes Rendering beim Skalieren */
    * { -webkit-font-smoothing: antialiased; }
  </style>
</head>

<body>
  <div id="viewport">
    <div id="content">
      <div
        class="mvv-departure-monitor"
        monitor-configuration="eyJsYW5ndWFnZSI6eyJkZXBhcnR1cmUiOiJBYmZhaHJ0IiwidHJhaW5TdG9wcyI6IkhhbHRlc3RlbGxlbiIsImRpcmVjdGlvbiI6IlJpY2h0dW5nIiwiZm9vdGVyTm90ZSI6IqkgQ29weXJpZ2h0IiwiZm9vdGVyVGV4dCI6IldlaXRlcmUgRmFocnBsYW5hdXNr/G5mdGUgdW50ZXIgd3d3Lm12di1hdXNrdW5mdC5kZSBvZGVyIG1pdCBkZXIgTVZWLUFwcCIsImhlYWRlclRleHQiOiJBYmZhaHJ0ZW4gZvxyIGhldXRlLCAiLCJsYW5ndWFnZSI6ImRlIiwibGluZSI6IkxpbmllIiwibGl2ZSI6IkxpdmUiLCJzdG9wIjoiSGFsdGVzdGVsbGUiLCJ0cmFjayI6IkdsZWlzIn0sImlzRnVsbHNjcmVlbiI6ZmFsc2UsInN0YXRpb25zIjpbeyJzdGF0aW9uIjp7InVzYWdlIjoic2YiLCJ0eXBlIjoiYW55IiwibmFtZSI6Ik38bmNoZW4sIERyeWdhbHNraS1BbGxlZSIsInN0YXRlbGVzcyI6IjkxMDAxNDY0IiwiYW55VHlwZSI6InN0b3AiLCJzb3J0IjoiMiIsInF1YWxpdHkiOiIyNjQiLCJiZXN0IjoiMSIsIm9iamVjdCI6IkRyeWdhbHNraS1BbGxlZSIsIm1haW5Mb2MiOiJN/G5jaGVuIiwibW9kZXMiOiI1IiwicmVmIjp7ImlkIjoiOTEwMDE0NjQiLCJnaWQiOiJkZTowOTE2MjoxNDY0Iiwib21jIjoiOTE2MjAwMCIsInBsYWNlSUQiOiIxIiwicGxhY2UiOiJN/G5jaGVuIiwiY29vcmRzIjoiMTI4MTEwOS4wMDAwMCw1ODc2Nzk3LjAwMDAwIn0sImlkIjoiZGU6MDkxNjI6MTQ2NCJ9LCJsaW5lcyI6W3sibnVtYmVyIjoiMTMyIiwic3ltYm9sIjoiMDMxMzIuc3ZnIiwiZGlyZWN0aW9uIjoiTWFyaWVucGxhdHoiLCJzdGF0ZWxlc3MiOiJzd206MDMxMzI6RzpSOjAxNiIsIm5hbWUiOiJCdXMifV0sImFsbExpbmVzIjpbeyJudW1iZXIiOiI1MSIsInN5bWJvbCI6IjI0MDUxLnN2ZyIsImRpcmVjdGlvbiI6IkFpZGVuYmFjaHN0cmHfZSIsInN0YXRlbGVzcyI6InN3bTowMzA1MTpHOkg6MDE2IiwibmFtZSI6Ik1ldHJvQnVzIn0seyJudW1iZXIiOiI1MSIsInN5bWJvbCI6IjI0MDUxLnN2ZyIsImRpcmVjdGlvbiI6Ik1vb3NhY2giLCJzdGF0ZWxlc3MiOiJzd206MDMwNTE6RzpSOjAxNiIsIm5hbWUiOiJNZXRyb0J1cyJ9LHsibnVtYmVyIjoiMTMyIiwic3ltYm9sIjoiMDMxMzIuc3ZnIiwiZGlyZWN0aW9uIjoiRm9yc3RlbnJpZWRlciBQYXJrIiwic3RhdGVsZXNzIjoic3dtOjAzMTMyOkc6SDowMTYiLCJuYW1lIjoiQnVzIn0seyJudW1iZXIiOiIxMzIiLCJzeW1ib2wiOiIwMzEzMi5zdmciLCJkaXJlY3Rpb24iOiJNYXJpZW5wbGF0eiIsInN0YXRlbGVzcyI6InN3bTowMzEzMjpHOlI6MDE2IiwibmFtZSI6IkJ1cyJ9LHsibnVtYmVyIjoiMTUxIiwic3ltYm9sIjoiMDMxNTEuc3ZnIiwiZGlyZWN0aW9uIjoiUGFya3N0YWR0IFNvbGxuIiwic3RhdGVsZXNzIjoic3dtOjAzMTUxOkc6SDowMTYiLCJuYW1lIjoiQnVzIn0seyJudW1iZXIiOiIxNTEiLCJzeW1ib2wiOiIwMzE1MS5zdmciLCJkaXJlY3Rpb24iOiJXZXN0ZnJpZWRob2YiLCJzdGF0ZWxlc3MiOiJzd206MDMxNTE6RzpSOjAxNiIsIm5hbWUiOiJCdXMifV0sImxlYWRUaW1lTWludXRlcyI6MH1dLCJsaW5lcyI6W10sIm1heFJlc3VsdHMiOjEwLCJmZXRjaEludGVydmFsSW5NaW51dGVzIjoyLCJzaG93Tm90aWZpY2F0aW9uIjp0cnVlfQ==">
      </div>
    </div>
  </div>

  <script src="https://www.mvv-muenchen.de/typo3conf/ext/sn_mvv_efa/Resources/Public/mvv-monitor/mvv-monitor.min.js"></script>

  <script>
    (function () {
      const viewport = document.getElementById("viewport");
      const content = document.getElementById("content");

      let raf = 0;

      function fitToViewport() {
        cancelAnimationFrame(raf);
        raf = requestAnimationFrame(() => {
          // Reset, damit wir die "natürliche" Größe messen können
          content.style.transform = "scale(1)";
          content.style.width = "auto";
          content.style.height = "auto";

          // NACH dem Reset messen
          const vpW = viewport.clientWidth;
          const vpH = viewport.clientHeight;

          // Scroll-Größen nehmen, weil der MVV-Block intern wachsen kann
          const cW = Math.max(content.scrollWidth, content.offsetWidth);
          const cH = Math.max(content.scrollHeight, content.offsetHeight);

          if (!vpW || !vpH || !cW || !cH) return;

          // Skalierung so, dass alles IMMER komplett sichtbar ist
          const scale = Math.min(vpW / cW, vpH / cH);

          content.style.transform = `scale(${scale})`;

          // Optional: Click/Touch-Fläche passend machen (verhindert “tote” Bereiche)
          content.style.width = (cW) + "px";
          content.style.height = (cH) + "px";
        });
      }

      // Reagiert auf Homey-Widget-Größenänderungen
      const ro = new ResizeObserver(fitToViewport);
      ro.observe(viewport);

      // Reagiert auf DOM-Änderungen im MVV-Widget (neue Abfahrten, andere Zeilenanzahl, etc.)
      const mo = new MutationObserver(fitToViewport);
      mo.observe(content, { childList: true, subtree: true, attributes: true });

      // Initial + nach kurzem Delay (falls das MVV-Script etwas später rendert)
      window.addEventListener("load", () => {
        fitToViewport();
        setTimeout(fitToViewport, 250);
        setTimeout(fitToViewport, 1000);
      });
    })();
  </script>
</body>
</html>
