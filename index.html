<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>MVV Abfahrten (Homey Widget)</title>

  <style>
    /* Homey-/Widget-freundliches Reset */
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden; /* keine Scrollbars im Widget */
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: transparent; /* Homey-Hintergrund nutzen */
    }

    /* Container, damit das Widget sauber skaliert */
    .wrap {
      height: 100%;
      width: 100%;
      display: flex;
      align-items: stretch;
      justify-content: stretch;
      padding: 0;
      box-sizing: border-box;
    }

    /* Optional: kleine Innenabstände, wenn du willst */
    .card {
      flex: 1 1 auto;
      min-height: 0; /* wichtig für Flex/Overflow in Widgets */
      min-width: 0;
      border-radius: 12px;
      overflow: hidden;
      background: rgba(0,0,0,0.10);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }

    /* Der MVV Monitor selbst soll den Platz nutzen */
    .mvv-departure-monitor {
      height: 100%;
      width: 100%;
    }

    /* Fallback-Message */
    .fallback {
      display: none;
      height: 100%;
      width: 100%;
      padding: 12px;
      box-sizing: border-box;
      color: #fff;
      background: rgba(0,0,0,0.25);
      font-size: 14px;
      line-height: 1.4;
    }

    /* Wenn Script nicht lädt, zeigen wir fallback */
    .show-fallback .fallback { display: block; }
    .show-fallback .card { display: none; }
  </style>
</head>

<body>
  <div id="root" class="wrap">
    <div class="card">
      <div
        class="mvv-departure-monitor"
        monitor-configuration="eyJsYW5ndWFnZSI6eyJkZXBhcnR1cmUiOiJBYmZhaHJ0IiwidHJhaW5TdG9wcyI6IkhhbHRlc3RlbGxlbiIsImRpcmVjdGlvbiI6IlJpY2h0dW5nIiwiZm9vdGVyTm90ZSI6IqkgQ29weXJpZ2h0IiwiZm9vdGVyVGV4dCI6IldlaXRlcmUgRmFocnBsYW5hdXNr/G5mdGUgdW50ZXIgd3d3Lm12di1hdXNrdW5mdC5kZSBvZGVyIG1pdCBkZXIgTVZWLUFwcCIsImhlYWRlclRleHQiOiJBYmZhaHJ0ZW4gZvxyIGhldXRlLCAiLCJsYW5ndWFnZSI6ImRlIiwibGluZSI6IkxpbmllIiwibGl2ZSI6IkxpdmUiLCJzdG9wIjoiSGFsdGVzdGVsbGUiLCJ0cmFjayI6IkdsZWlzIn0sImlzRnVsbHNjcmVlbiI6ZmFsc2UsInN0YXRpb25zIjpbeyJzdGF0aW9uIjp7InVzYWdlIjoic2YiLCJ0eXBlIjoiYW55IiwibmFtZSI6Ik38bmNoZW4sIERyeWdhbHNraS1BbGxlZSIsInN0YXRlbGVzcyI6IjkxMDAxNDY0IiwiYW55VHlwZSI6InN0b3AiLCJzb3J0IjoiMiIsInF1YWxpdHkiOiIyNjMiLCJiZXN0IjoiMSIsIm9iamVjdCI6IkRyeWdhbHNraS1BbGxlZSIsIm1haW5Mb2MiOiJN/G5jaGVuIiwibW9kZXMiOiI1IiwicmVmIjp7ImlkIjoiOTEwMDE0NjQiLCJnaWQiOiJkZTowOTE2MjoxNDY0Iiwib21jIjoiOTE2MjAwMCIsInBsYWNlSUQiOiIxIiwicGxhY2UiOiJN/G5jaGVuIiwiY29vcmRzIjoiMTI4MTEwOS4wMDAwMCw1ODc2Nzk3LjAwMDAwIn0sImlkIjoiZGU6MDkxNjI6MTQ2NCJ9LCJsaW5lcyI6W3sibnVtYmVyIjoiNTEiLCJzeW1ib2wiOiIyNDA1MS5zdmciLCJkaXJlY3Rpb24iOiJNb29zYWNoIiwic3RhdGVsZXNzIjoic3dtOjAzMDUxOkc6UjowMTYiLCJuYW1lIjoiTWV0cm9CdXMifSx7Im51bWJlciI6IjEzMiIsInN5bWJvbCI6IjAzMTMyLnN2ZyIsImRpcmVjdGlvbiI6Ik1hcmllbnBsYXR6Iiwic3RhdGVsZXNzIjoic3dtOjAzMTMyOkc6UjowMTYiLCJuYW1lIjoiQnVzIn0seyJudW1iZXIiOiIxNTEiLCJzeW1ib2wiOiIwMzE1MS5zdmciLCJkaXJlY3Rpb24iOiJXZXN0ZnJpZWRob2YiLCJzdGF0ZWxlc3MiOiJzd206MDMxNTE6RzpSOjAxNiIsIm5hbWUiOiJCdXMifV0sImFsbExpbmVzIjpbeyJudW1iZXIiOiI1MSIsInN5bWJvbCI6IjI0MDUxLnN2ZyIsImRpcmVjdGlvbiI6IkFpZGVuYmFjaHN0cmHfZSIsInN0YXRlbGVzcyI6InN3bTowMzA1MTpHOkg6MDE2IiwibmFtZSI6Ik1ldHJvQnVzIn0seyJudW1iZXIiOiI1MSIsInN5bWJvbCI6IjI0MDUxLnN2ZyIsImRpcmVjdGlvbiI6Ik1vb3NhY2giLCJzdGF0ZWxlc3MiOiJzd206MDMwNTE6RzpSOjAxNiIsIm5hbWUiOiJNZXRyb0J1cyJ9LHsibnVtYmVyIjoiMTMyIiwic3ltYm9sIjoiMDMxMzIuc3ZnIiwiZGlyZWN0aW9uIjoiRm9yc3RlbnJpZWRlciBQYXJrIiwic3RhdGVsZXNzIjoic3dtOjAzMTMyOkc6SDowMTYiLCJuYW1lIjoiQnVzIn0seyJudW1iZXIiOiIxMzIiLCJzeW1ib2wiOiIwMzEzMi5zdmciLCJkaXJlY3Rpb24iOiJNYXJpZW5wbGF0eiIsInN0YXRlbGVzcyI6InN3bTowMzEzMjpHOlI6MDE2IiwibmFtZSI6IkJ1cyJ9LHsibnVtYmVyIjoiMTUxIiwic3ltYm9sIjoiMDMxNTEuc3ZnIiwiZGlyZWN0aW9uIjoiUGFya3N0YWR0IFNvbGxuIiwic3RhdGVsZXNzIjoic3dtOjAzMTUxOkc6SDowMTYiLCJuYW1lIjoiQnVzIn0seyJudW1iZXIiOiIxNTEiLCJzeW1ib2wiOiIwMzE1MS5zdmciLCJkaXJlY3Rpb24iOiJXZXN0ZnJpZWRob2YiLCJzdGF0ZWxlc3MiOiJzd206MDMxNTE6RzpSOjAxNiIsIm5hbWUiOiJCdXMifV0sImxlYWRUaW1lTWludXRlcyI6MH1dLCJsaW5lcyI6W10sIm1heFJlc3VsdHMiOjEwLCJmZXRjaEludGVydmFsSW5NaW51dGVzIjoyLCJzaG93Tm90aWZpY2F0aW9uIjp0cnVlfQ=="
      ></div>
    </div>

    <div class="fallback">
      <strong>MVV Widget konnte nicht geladen werden.</strong><br>
      Prüfe, ob externe Skripte in Homey erlaubt sind und ob die URL erreichbar ist.
    </div>
  </div>

  <!-- MVV Script -->
  <script
    src="https://www.mvv-muenchen.de/typo3conf/ext/sn_mvv_efa/Resources/Public/mvv-monitor/mvv-monitor.min.js"
    referrerpolicy="no-referrer"
  ></script>

  <script>
    // Fallback, falls das MVV Script geblockt wird oder nicht lädt
    (function () {
      const root = document.getElementById("root");

      // Wenn innerhalb von 3 Sekunden keine MVV-UI gerendert wurde, fallback anzeigen
      const t = setTimeout(() => {
        // Heuristik: wenn der Monitor leer bleibt, zeigen wir fallback
        const monitor = document.querySelector(".mvv-departure-monitor");
        const hasContent = monitor && monitor.children && monitor.children.length > 0;
        if (!hasContent) root.classList.add("show-fallback");
      }, 3000);

      window.addEventListener("load", () => clearTimeout(t));
    })();
  </script>
</body>
</html>
